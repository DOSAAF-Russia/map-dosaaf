# Документация проекта Map Dosaaf

## Терминология.

В документации используются следующие термины:
- **структурное подразделение**: это обобщенное название сущности, которое надо отображать на карте. В начале это были: Единые центры, региональные отделения/центры, зональные центры, а также юридические организации с разными типами (аэродром, автомобильная школа, учебный центр и т.д.).

## Описание проекта

**Карта для ДОСААФ** - это веб-приложение, разработанное для предоставления информации о структурных подразделениях. Приложение использует Flask в качестве веб-фреймворка и SQLAlchemy для взаимодействия с базой данных, где хранится информация о подразделениях. Также есть должна быть возможность добавлять, редактировать и удалять подразделения. 

## На раздумие
Изначально index.html, это UI разработанный с упором на наблюдение за процессом разработки, где пользователи могли оставлять отзывы, предлагать новые фичи и так далее. Сейчас нет какой либо авторизации, веб приложение публично. Можно убрать эту обертку в виде ui friendly интерфейса, а можно оставить и повесить авторизацию.

## Файловое дерево проекта
- ./map_dosaaf - основной код приложения
- ./data - сырьё. файлы, предоставляющие данные для обработки самим приложением.
- ./scripts - какие нибудь скрипты.
- ./var - временные файлы, получившиеся во время сбора данных из удаленных сервисов / формирование датасета / и других операций.
- ./util-database.db - утилитарная база данных sqlite, куда сохраняются отзывы о работе и предложениях.
- ./config.yml - конфиг приложения.
- ./map_dosaaf/frontend/flask/static - файлы javascript библиотек, каталог node_modules, файлы css и js, а также картинки.
- map_dosaaf/frontend/flask/templates/script.js - javacsript точка входа в веб приложение.
- map_dosaaf/_utils.py - файл, не относящийся напрямую к функционалу приложения. Здесь проверялись гипотезы, парсились сайты, собирались датасеты. В общем это файл с временныи кодом.

## Стек технологий

### Python библиотеки

- **Flask** - веб-фреймворк для создания веб-приложений.
- **SQLAlchemy** - ORM для работы с базами данных.
- **PostgreSQL** - СУБД.
- **Asyncpg** - асинхронный драйвер для postgresql.
- **aiosqlite** - асинхронный драйвер для SQLite.
- **Pandas** и **NumPy** - библиотеки для обработки данных.
- **Shapely** - библиотека для работы с геометрией.
- **Orjson** - библиотека для быстрой сериализации/десериализации JSON.
- **GitPython** - библиотека для работы с Git-репозиториями.
- **openpyxl** - для работы с Excel-файлами.
- **envyaml** - для конфигурирования проекта с использованием YAML-файлов и переменными окружения.
- **pydantic** - для обозначения типов данных и их валидации.
- **loguru** - логгирование.
- **httpx**, **aiohttp**, **bs4**, **lxml**, **ua-generator** - парсинг сайтов.
- **geopy** - для работы с геокодирования и обратного геокодирования.

### Javascript библиотеки

- **Leaflet** - библиотека для создания карт.
- **Leaflet.markercluster** - библиотека для группировки маркеров на
карте.
- **Leaflet Switch Basemap** - Эта библиотека позволяет пользователям переключаться между различными базовыми картами в Leaflet (гибрид, схема, спутник).
- **Leaflet Search** - Позволяет добавлять функциональность поиска на карты Leaflet. Пользователи могут искать места или объекты на карте, и библиотека отображает результаты поиска.
- **Leaflet Beautify Marker Icon** - Эта библиотека предоставляет возможность использовать красивые иконки для маркеров на картах Leaflet, улучшая визуальное восприятие.
- **Leaflet VectorGrid** - Библиотека для отображения векторных тайлов на картах Leaflet. Она позволяет работать с векторной графикой, что может улучшить качество отображения и производительность.
- **PruneCluster** - Это еще одна библиотека для кластеризации маркеров, которая оптимизирована для работы с большим количеством маркеров. Она обеспечивает высокую производительность и плавную работу при масштабировании карты.
- **turf.js** - Библиотека для геопространственной обработки данных. Она предоставляет множество функций для работы с геометрией, анализа данных и манипуляций с геоданными.
- **leaflet easybutton** - Позволяет добавлять пользовательские кнопки на карту Leaflet. Это полезно для создания интерфейсов с дополнительными функциями, такими как изменение масштаба или выполнение других действий.
- **fuse.js** - Библиотека для реализации нечеткого поиска. Она позволяет выполнять поиск по массивам объектов с поддержкой нечеткого сопоставления, что делает ее полезной для поиска по данным на карте или в списках.

## Установка и настройка

### Текущее рабочее окружение

- Python 3.12
- Pip 24.2
- Node v22.9.0
- Npm v10.9.0

### установка зависимостей и сетап рабочего окружения

Рекомендую использовать poetry как менеджер пакетов.

- Устанавливаем python зависимости. Они есть в файле `pyproject.toml`

- Устанавливаем node зависимости.

```bash
cd ./map_dosaaf/frontend/flask/static/node_modules
npm install
```

### поднятие приложения с помощью docker

```bash
docker compose up
```
